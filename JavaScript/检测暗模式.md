# æ£€æµ‹æš—æ¨¡å¼

macOSã€Windows 10 ç­‰ç°ä»£æ“ä½œç³»ç»Ÿå…è®¸ç”¨æˆ·é€‰æ‹©ä»–ä»¬å¸Œæœ›åœ¨æ‰€æœ‰åº”ç”¨ç¨‹åºä¸­çœ‹åˆ°çš„å¤–è§‚ã€‚

ä»¥ä¸‹å±å¹•æˆªå›¾å–è‡ª macOS çš„*å¸¸è§„*è®¾ç½®ï¼š

![åœ¨ macOS ä¸­è®¾ç½®æš—æ¨¡å¼](https://upload-images.jianshu.io/upload_images/18281896-ba7aea525293ad07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¯ä»¥é€šè¿‡æŸ¥çœ‹ `prefers-color-scheme` åª’ä½“æŸ¥è¯¢æ¥æ£€æµ‹è¯¥é€‰é¡¹ã€‚

å®ƒå¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š

- `light`ï¼šç”¨æˆ·å¸Œæœ›ä»¥æµ…è‰²æ¨¡å¼æŸ¥çœ‹é¡µé¢
- `dark`ï¼šç”¨æˆ·å¸Œæœ›åœ¨æš—é»‘æ¨¡å¼ä¸‹æŸ¥çœ‹é¡µé¢
- `no-preference`ï¼šç³»ç»Ÿä¸çŸ¥é“ç”¨æˆ·çš„åå¥½

é€šè¿‡æ£€æŸ¥æ­¤åª’ä½“æŸ¥è¯¢å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šç”¨æˆ·æ˜¯å¦å–œæ¬¢æš—æ¨¡å¼ï¼Œè·å–ç³»ç»Ÿæ˜¯å¦å¤„äºæš—æ¨¡å¼ä¸‹æœ‰ä¸¤ç§æ–¹å¼ã€‚

ä½¿ç”¨ CSS åª’ä½“æŸ¥è¯¢æ£€æµ‹ CSS ä¸­çš„é¦–é€‰é…è‰²æ–¹æ¡ˆï¼š

```css
/* Light mode */
@media (prefers-color-scheme: light) {
  body {
    filter: invert(0);
  }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  body {
    filter: invert(100%) hue-rotate(180deg);
  }
}
```

ä½¿ç”¨ `matchMedia` æ–¹æ³•æ£€æµ‹ JS ä¸­çš„é¦–é€‰é…è‰²æ–¹æ¡ˆï¼š

```js
const isDarkMode =
  window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
```

æˆ–è€…ä¹Ÿè®¸æ˜¯æ›´é€šç”¨çš„æ–¹æ³•ï¼š

```js
const checkType = (type) =>
  window.matchMedia &&
  window.matchMedia(`(prefers-color-scheme: ${type})`).matches

const mode = {
  is: {
    dark: checkType('dark'),
    light: checkType('light')
  }
}

mode.is.dark // true
mode.is.light // false
```

å¦å¤–ï¼Œå¦‚æœç”¨æˆ·åœ¨é¡µé¢æ‰“å¼€æ—¶æ›´æ”¹é¦–é€‰é¡¹é…è‰²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`addListener`](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList/addListener) æ–¹æ³•ï¼ˆä¸è¦ä¸ `addEventListener` æ··æ·†ï¼‰ç›‘å¬ç³»ç»Ÿé¢œè‰²çš„åˆ‡æ¢ï¼Œæ¥åŠ¨æ€æ›´æ”¹é¢œè‰²ã€‚

ä¾‹å¦‚ï¼š

```js
window.matchMedia('(prefers-color-scheme: dark)').addListener((e) => {
  const isDarkMode = e.matches
  console.log(`${isDarkMode ? 'ğŸŒš' : 'ğŸŒ'}.`)
})
```

å¼ºåˆ¶è®¾ç½®æš—æ¨¡å¼ï¼š

```js
const forceDarkMode = () =>
  [...document.styleSheets[0].rules].forEach((rule) => {
    const mediaText = (rule.media && rule.media.mediaText) || []
    const hasColorScheme = mediaText.includes('prefers-color-scheme')
    const hasLightScheme = hasColorScheme && mediaText.includes('light')

    // å¦‚æœéœ€è¦ï¼Œè¯·åˆ é™¤äº®æ¨¡å¼ã€‚
    if (hasLightScheme) {
      rule.media.deleteMedium('(prefers-color-scheme: light)')
    }

    // æ·»åŠ æš—æ¨¡å¼
    rule.media && rule.media.appendMedium('(prefers-color-scheme: dark)')
  })
```

## æ›´å¤šèµ„æ–™

[JavaScript åª’ä½“æŸ¥è¯¢](https://github.com/lio-zero/blog/blob/main/JavaScript/JavaScript%20%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2.md)
